{% extends 'base.html' %}

{% block title %}Edit Player - {{ player.full_name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-12">
            <h2><i class="fas fa-edit"></i> Edit Player Information</h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'teams:admin_manage_players' %}">Manage Players</a></li>
                    <li class="breadcrumb-item active">Edit {{ player.full_name }}</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5><i class="fas fa-user-edit"></i> Player Details</h5>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <!-- Personal Information -->
                        <fieldset class="border p-3 mb-4">
                            <legend class="w-auto px-2"><h5>Personal Information</h5></legend>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="first_name" class="form-label">First Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="first_name" name="first_name" 
                                           value="{{ player.first_name }}" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="last_name" class="form-label">Last Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="last_name" name="last_name" 
                                           value="{{ player.last_name }}" required>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="date_of_birth" class="form-label">Date of Birth <span class="text-danger">*</span></label>
                                    <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" 
                                           value="{{ player.date_of_birth|date:'Y-m-d' }}" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="nationality" class="form-label">Nationality</label>
                                    <input type="text" class="form-control" id="nationality" name="nationality" 
                                           value="{{ player.nationality }}" placeholder="e.g., Kenyan">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="id_number" class="form-label">National ID Number <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="id_number" name="id_number" 
                                           value="{{ player.id_number }}" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="photo" class="form-label">Player Photo</label>
                                    <input type="file" class="form-control" id="photo" name="photo" accept="image/*">
                                    {% if player.photo %}
                                    <small class="text-muted">Current photo: <a href="{{ player.photo.url }}" target="_blank">View</a></small>
                                    {% endif %}
                                </div>
                            </div>
                        </fieldset>

                        <!-- FKF License Information -->
                        <fieldset class="border p-3 mb-4">
                            <legend class="w-auto px-2"><h5>FKF License Information</h5></legend>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="fkf_license_number" class="form-label">FKF License Number</label>
                                    <input type="text" class="form-control" id="fkf_license_number" name="fkf_license_number" 
                                           value="{{ player.fkf_license_number }}" placeholder="e.g., FKF-2024-12345">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="license_expiry_date" class="form-label">License Expiry Date</label>
                                    <input type="date" class="form-control" id="license_expiry_date" name="license_expiry_date" 
                                           value="{% if player.license_expiry_date %}{{ player.license_expiry_date|date:'Y-m-d' }}{% endif %}">
                                </div>
                            </div>
                        </fieldset>

                        <!-- Team Information -->
                        <fieldset class="border p-3 mb-4">
                            <legend class="w-auto px-2"><h5>Team Information</h5></legend>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="team" class="form-label">Team <span class="text-danger">*</span></label>
                                    <select class="form-control" id="team" name="team" required>
                                        {% for team in teams %}
                                        <option value="{{ team.id }}" {% if player.team.id == team.id %}selected{% endif %}>
                                            {{ team.team_name }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="position" class="form-label">Position <span class="text-danger">*</span></label>
                                    <select class="form-control" id="position" name="position" required>
                                        {% for code, name in position_choices %}
                                        <option value="{{ code }}" {% if player.position == code %}selected{% endif %}>
                                            {{ name }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="jersey_number" class="form-label">Jersey Number <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="jersey_number" name="jersey_number" 
                                           value="{{ player.jersey_number }}" min="1" max="99" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="form-check mt-4">
                                        <input class="form-check-input" type="checkbox" id="is_captain" name="is_captain" 
                                               {% if player.is_captain %}checked{% endif %}>
                                        <label class="form-check-label" for="is_captain">
                                            <i class="fas fa-star text-warning"></i> Team Captain
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </fieldset>

                        <!-- Statistics -->
                        <fieldset class="border p-3 mb-4">
                            <legend class="w-auto px-2"><h5>Statistics (Manual Adjustment)</h5></legend>
                            <p class="text-muted small">Admin can manually adjust player statistics if needed</p>
                            
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label for="goals_scored" class="form-label">âš½ Goals Scored</label>
                                    <input type="number" class="form-control" id="goals_scored" name="goals_scored" 
                                           value="{{ player.goals_scored }}" min="0">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="yellow_cards" class="form-label">ðŸŸ¨ Yellow Cards</label>
                                    <input type="number" class="form-control" id="yellow_cards" name="yellow_cards" 
                                           value="{{ player.yellow_cards }}" min="0">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="red_cards" class="form-label">ðŸŸ¥ Red Cards</label>
                                    <input type="number" class="form-control" id="red_cards" name="red_cards" 
                                           value="{{ player.red_cards }}" min="0">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="matches_played" class="form-label">ðŸ“Š Matches Played</label>
                                    <input type="number" class="form-control" id="matches_played" name="matches_played" 
                                           value="{{ player.matches_played }}" min="0">
                                </div>
                            </div>
                        </fieldset>

                        <!-- Action Buttons -->
                        <div class="row">
                            <div class="col-md-12">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                                <a href="{% url 'teams:admin_manage_players' %}" class="btn btn-secondary btn-lg">
                                    <i class="fas fa-times"></i> Cancel
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Player Info Card -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5><i class="fas fa-info-circle"></i> Current Player Info</h5>
                </div>
                <div class="card-body text-center">
                    {% if player.photo %}
                    <img src="{{ player.photo.url }}" alt="{{ player.full_name }}" class="img-fluid rounded-circle mb-3" style="max-width: 150px;">
                    {% else %}
                    <i class="fas fa-user-circle fa-5x text-muted mb-3"></i>
                    {% endif %}
                    <h4>{{ player.full_name }}</h4>
                    <p class="text-muted">{{ player.get_position_display }}</p>
                    <hr>
                    <div class="row text-center">
                        <div class="col-6">
                            <strong>Team</strong>
                            <p>{{ player.team.team_name }}</p>
                        </div>
                        <div class="col-6">
                            <strong>Jersey #</strong>
                            <p class="h3">#{{ player.jersey_number }}</p>
                        </div>
                    </div>
                    <hr>
                    <div class="row text-center">
                        <div class="col-4">
                            <strong>Goals</strong>
                            <p>âš½ {{ player.goals_scored }}</p>
                        </div>
                        <div class="col-4">
                            <strong>Yellow</strong>
                            <p>ðŸŸ¨ {{ player.yellow_cards }}</p>
                        </div>
                        <div class="col-4">
                            <strong>Red</strong>
                            <p>ðŸŸ¥ {{ player.red_cards }}</p>
                        </div>
                    </div>
                    <hr>
                    <p class="small text-muted">
                        <i class="fas fa-calendar"></i> Registered: {{ player.registration_date|date:"M d, Y" }}
                    </p>
                    {% if player.is_suspended %}
                    <div class="alert alert-danger">
                        <i class="fas fa-ban"></i> Currently Suspended
                        <br><small>{{ player.suspension_reason }}</small>
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header bg-warning">
                    <h6><i class="fas fa-exclamation-triangle"></i> Important Notes</h6>
                </div>
                <div class="card-body">
                    <ul class="small">
                        <li>Changing team will transfer the player</li>
                        <li>ID number changes should be verified carefully</li>
                        <li>Statistics can be manually adjusted if needed</li>
                        <li>Photo changes will replace the existing photo</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    fieldset {
        border-radius: 8px;
    }
    
    fieldset legend h5 {
        font-size: 1rem;
        margin-bottom: 0;
    }
    
    .card {
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-radius: 8px;
    }
</style>
{% endblock %}
